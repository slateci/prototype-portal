{%extends "base.html"%}

{%block title%}
  Create New Volume
{%endblock%}

{%block body%}
<section id="volume-create" class="bg-light">
  <div class="container">
    

    <div class="row">
      <div class="col-lg-12 mx-auto">
       {%include 'messages.html' %}
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="{{url_for('dashboard')}}">Home</a></li>
          <li class="breadcrumb-item"><a href="{{url_for('list_groups')}}">Group</a></li>
          <li class="breadcrumb-item"><a href="{{url_for('view_group', name=name)}}">{{name}}</a></li>
          <li class="breadcrumb-item active">New Volume</li>
        </ol>
        <h1>Create New Volume</h1>
        <p class="lead">
          Enter Volume information below
        </p>
        <hr/>

            <form role="form" action="{{url_for('create_group_volume', name = name)}}" method="POST">
              {% if not minislate_user %}
              <div class="form-group">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
              </div>
              {% endif %}
              <div class="form-group">
                <label for="name">Volume Name * (lowercase, alpha-numeric and -)</label>
                <input
                  type="text"
                  class="form-control"
                  id="volume-name"
                  name="volume-name"
                  placeholder="my-volume"
                  pattern="[a-zA-Z0-9-]+"
                  required="required"
                  tabindex="1"
                  style="text-transform:lowercase"
                  maxlength="64"
                >
              </div>

              <div class="form-group">
                <label for="cluster">Cluster</label>
                <select class="form-control" id="cluster" name="cluster" required="required" tabindex="1">
                  <option value="" selected disabled>--- Select One ---</option>
                  <option v-for='cluster in clusters' :value="cluster.metadata.name">{[{cluster.metadata.name}]}</option>
                </select>
              </div>

              <div class="form-group">
                <label for="storageRequest">Volume Size * (expressed in: E, P, T, G, M, K, Ei, Pi, Ti, Gi, Mi, Ki)</label>
                <input 
                  type="text"
                  class="form-control"
                  id="storageRequest"
                  name="storageRequest"
                  placeholder="1G"
                  pattern="\d{1,5}[a-zA-Z]{1,2}"
                  required="required"
                  tabindex="1"
                  maxlength="64"
                >
              </div>
              
              <div class="form-group">
                <label for="storageClass">Kubernetes StorageClass * (lowercase, alpha-numeric and -)</label>
                <input
                  type="text"
                  class="form-control"
                  id="storageClass"
                  name="storageClass"
                  placeholder="nfs-provisioner"
                  pattern="[a-zA-Z0-9-]+"
                  required="required"
                  tabindex="1"
                  maxlength="64"
                >
              </div>
                
              <div class="form-group">
                <label for="accessMode">AccessMode * (ReadWriteOnce, ReadWriteMany, ReadOnlyMany)</label>
                <input
                  type="text"
                  class="form-control"
                  id="accessMode"
                  name="accessMode"
                  placeholder="ReadWriteOnce"
                  pattern="[a-zA-Z0-9-]+"
                  required="required"
                  tabindex="1"
                  maxlength="64"
                >
              </div>
                
              <div class="form-group">
                <label for="volumeMode">VolumeMode * (Filesystem, Block)</label>
                <input
                  type="text"
                  class="form-control"
                  id="volumeMode"
                  name="volumeMode"
                  placeholder="Filesystem"
                  pattern="[a-zA-Z0-9-]+"
                  required="required"
                  tabindex="1"
                  maxlength="64"
                >
              </div>

              <div class="form-group">
                <button type="submit" class="btn btn-primary">Create</button>
              </div>
            </form>

      </div>

    </div>
  </div>
</section>
  
<script>
$(document).ready(function() {
  new Vue({
	el: '#cluster',
	data () {
    return {
      clusters: {},
		  loading: true,
		  failed: false
	  }
	},
	mounted() {
    axios.get('/volumes-create-bygroup-xhr/{{name}}')
    .then(function (response) {
      console.log(response);
      this.clusters = response.data;
			this.loading = false;
		}.bind(this)) //must use bind(this) unless using arrow function
		.catch(error => { this.failed = true; this.loading = false; })
	},
  updated: function() {
    // Function to sort group listing after mounted
	  var options = $('select.form-control option');
    var arr = options.map(function(_, o) { return { t: $(o).text(), v: o.value }; }).get();
    arr.sort(function(o1, o2) { return o1.t > o2.t ? 1 : o1.t < o2.t ? -1 : 0; });
    options.each(function(i, o) {
      o.value = arr[i].v;
      $(o).text(arr[i].t);
    });
	}
});

})
</script>

{%endblock%}
